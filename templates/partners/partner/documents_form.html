{% extends "layouts/dashboard.html" %}
{% load static %}
{% load i18n %}
{% load widget_tweaks %}

{% block title_page %}{{ title }}{% endblock title_page %}
{% block toolbar_title %}{{ title }}{% endblock %}

{% block entity_options %}
<div class="d-flex align-items-center py-1">
    <a href="{% url 'apps.partners:partner-list' %}" class="btn btn-sm btn-light">
        <i class="ki-duotone ki-arrow-left fs-4">
            <span class="path1"></span>
            <span class="path2"></span>
        </i>
        {% trans "Back to List" %}
    </a>
</div>
{% endblock %}

{% block content %}
<div class="container-xxl">
    <!-- Tab Navigation -->
    <div class="card mb-5 mb-xl-8">
        <div class="card-header border-0 pt-5">
            <h3 class="card-title align-items-start flex-column">
                <span class="card-label fw-bold fs-3 mb-1">{{ title }}</span>
            </h3>
        </div>
        <div class="card-body">
            <ul class="nav nav-tabs nav-line-tabs nav-line-tabs-2x mb-5 fs-6">
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'apps.partners:partner-edit' partner.pk %}">
                        <i class="ki-duotone ki-user fs-2 me-2">
                            <span class="path1"></span>
                            <span class="path2"></span>
                        </i>
                        {% trans "Basic Information" %}
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'apps.partners:partner-employment' partner.pk %}">
                        <i class="ki-duotone ki-briefcase fs-2 me-2">
                            <span class="path1"></span>
                            <span class="path2"></span>
                        </i>
                        {% trans "Employment Information" %}
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link active">
                        <i class="ki-duotone ki-folder fs-2 me-2">
                            <span class="path1"></span>
                            <span class="path2"></span>
                        </i>
                        {% trans "Documents" %}
                    </a>
                </li>
            </ul>

            <div class="tab-content" id="partner-tabs">
                <!-- Documents Tab -->
                <div class="tab-pane fade show active" id="documents-info" role="tabpanel">
                    <div class="row g-5 g-xl-8">
                        <!-- Upload New Document -->
                        <div class="col-xl-4">
                            <div class="card card-flush mb-6 mb-xl-9">
                                <div class="card-header">
                                    <div class="card-title">
                                        <h2 class="mb-0">{% trans "Upload New Document" %}</h2>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <form method="post" enctype="multipart/form-data">
                                        {% csrf_token %}

                                        <div class="mb-6">
                                            <label class="form-label required">{% trans "Document Type" %}</label>
                                            <select name="document_type" class="form-select" required>
                                                <option value="">{% trans "Select document type" %}</option>
                                                {% load documents_to_partners %}
                                                {% get_document_type_choices_to_partners as document_types %}
                                                {% for document_type in document_types %}
                                                    <option value="{{ document_type.pk }}">{{ document_type.name }}</option>
                                                {% endfor %}
                                            </select>
                                            <div class="form-text">{% trans "Select the type of document you are uploading" %}</div>
                                        </div>

                                        <div class="mb-6">
                                            <label class="form-label required">{% trans "Document File" %}</label>
                                            <input type="file" name="file" class="form-control" accept=".pdf,.doc,.docx,.jpg,.jpeg,.png,.gif" required>
                                            <div class="form-text">{% trans "Accepted formats: PDF, DOC, DOCX, JPG, PNG, GIF" %}</div>
                                        </div>

                                        <div class="text-center">
                                            <button type="submit" class="btn btn-primary">
                                                <i class="ki-duotone ki-cloud-add fs-2">
                                                    <span class="path1"></span>
                                                    <span class="path2"></span>
                                                </i>
                                                {% trans "Upload Document" %}
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>

                        <!-- Documents List -->
                        <div class="col-xl-8">
                            <div class="card card-flush">
                                <div class="card-header">
                                    <div class="card-title">
                                        <h2 class="mb-0">{% trans "Partner Documents" %} ({{ documents.count }})</h2>
                                    </div>
                                </div>
                                <div class="card-body">
                                    {% if documents %}
                                        <div class="table-responsive">
                                            <table class="table align-middle gs-0 gy-4">
                                                <thead>
                                                    <tr class="fw-bold text-muted">
                                                        <th class="min-w-200px">{% trans "Document" %}</th>
                                                        <th class="min-w-100px">{% trans "Status" %}</th>
                                                        <th class="min-w-120px">{% trans "Date" %}</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {% for document in documents %}
                                                    <tr data-document-id="{{ document.pk }}">
                                                        <td>
                                                            <div class="d-flex align-items-center">
                                                                <div class="symbol symbol-45px me-5">
                                                                    <div class="symbol-label fs-3 fw-semibold text-primary">
                                                                        <i class="ki-duotone ki-document fs-2">
                                                                            <span class="path1"></span>
                                                                            <span class="path2"></span>
                                                                        </i>
                                                                    </div>
                                                                </div>
                                                                <div class="d-flex justify-content-start flex-column">
                                                                    <span class="text-dark fw-bold text-hover-primary fs-6">{{ document.document_type.name|default:"-" }}</span>
                                                                    <span class="text-muted fw-semibold text-muted d-block fs-7">{{ document.document_number|default:"-" }}</span>
                                                                </div>
                                                            </div>
                                                        </td>
                                                        <td>
                                                            <span class="badge {{ document.status_badge_class }}">{{ document.get_status_display }}</span>
                                                        </td>
                                                        <td>
                                                            <div class="d-flex flex-column">
                                                                <span class="text-gray-800 fs-7">{{ document.created|date:"M d, Y" }}</span>
                                                                <span class="text-muted fs-7">{{ document.created_by|default:"-" }}</span>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                    {% endfor %}
                                                </tbody>
                                            </table>
                                        </div>
                                    {% else %}
                                        <div class="d-flex flex-column flex-center py-10">
                                            <div class="symbol symbol-100px symbol-lg-160px symbol-fixed position-relative mb-5">
                                                <div class="symbol-label fs-2 fw-semibold text-muted">
                                                    <i class="ki-duotone ki-folder fs-2x">
                                                        <span class="path1"></span>
                                                        <span class="path2"></span>
                                                    </i>
                                                </div>
                                            </div>
                                            <div class="fs-3 text-gray-800 fw-bold mb-3">{% trans "No documents uploaded yet" %}</div>
                                            <div class="fs-6 text-gray-600 text-center mb-8">
                                                {% trans "Upload your first document using the form on the left." %}
                                            </div>
                                        </div>
                                    {% endif %}

                                    <!-- Help Information -->
                                    <div class="alert alert-info mt-6">
                                        <div class="alert-text">
                                            <strong>{% trans "Document Management Tips:" %}</strong><br>
                                            • {% trans "Select the appropriate document type from the dropdown" %}<br>
                                            • {% trans "Upload important partner documents like contracts, identification, etc." %}<br>
                                            • {% trans "All documents are automatically categorized as Personal" %}<br>
                                            • {% trans "Documents are automatically linked to this partner" %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Action Buttons -->
    <div class="d-flex justify-content-end mt-6">
        <a href="{% url 'apps.partners:partner-list' %}" class="btn btn-light me-3">{% trans "Back to Partner" %}</a>
        <a href="{% url 'apps.documents:document-list' %}" class="btn btn-primary">
            {% trans "View All Documents" %}
        </a>
    </div>
</div>

<!-- Document Modal -->
<div class="modal fade" id="documentModal" tabindex="-1" aria-labelledby="documentModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered">
        <div class="modal-content" id="documentModalContent">
            <!-- Modal content will be loaded here via AJAX -->
        </div>
    </div>
</div>
{% endblock content %}
